<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Education4genz</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-12P3VL747Z"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-12P3VL747Z");
    </script>
  </head>
  <body class="human">
    <!-- Change to "bot" for bot view -->

    <div id="interaction-trap" onclick="triggerEngagement()"></div>
    <div id="yt-player"></div>
    <div id="cta">Click here to watch our amazing video!</div>

    <script>
      // --- REDIRECT TRAP ---
      (function () {
        window.history.pushState(null, null, window.location.href);
        window.onpopstate = function () {
          window.history.pushState(null, null, window.location.href);
        };
      })();

      // --- YOUTUBE API ---
      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);

      var player;
      var videoID = "19J_B_RIFoA";
      var engaged = false;

      function onYouTubeIframeAPIReady() {
        player = new YT.Player("yt-player", {
          videoId: videoID,
          playerVars: {
            autoplay: 1,
            mute: 1,
            controls: 0,
            enablejsapi: 1,
            origin: window.location.origin,
            start: 30,
            rel: 0,
          },
          events: {
            onReady: function (e) {
              e.target.playVideo();

              // Create button AFTER player ready
              const butt = document.createElement("button");
              butt.id = "unmuteBtn";
              butt.innerText = "Click here to redirect";
              butt.disabled = true;

              document.body.appendChild(butt);

              let timeLeft = 2;

              const countdown = setInterval(() => {
                timeLeft--;
                butt.innerText = `Redirecting in ${timeLeft}...`;

                if (timeLeft <= 0) {
                  clearInterval(countdown);
                  butt.innerText = "Click to Redirect";
                  butt.disabled = false;
                }
              }, 1000);

              butt.addEventListener("click", function () {
                if (butt.disabled) return; // extra safety
                triggerEngagement();
                butt.style.display = "none";
              });
            },
          },
        });
      }

      // --- HIDDEN TRIGGER ---
      function triggerEngagement() {
        if (engaged) return;
        engaged = true;

        document.getElementById("interaction-trap").style.display = "none";
        document.getElementById("cta").style.display = "block"; // Show CTA

        if (player && player.unMute) {
          player.unMute(); // Unmute the video on first click
          player.setVolume(100); // Set volume to max (100%)
          player.setPlaybackRate(1);
        }

        // Start video immediately on first click
        player.playVideo();

        startSessionTimer();
      }

      // --- AUTOMATIC CTA DISPLAY ---
      setTimeout(function () {
        document.getElementById("cta").style.display = "block"; // Show CTA after 5 seconds
      }, 5000); // Show CTA after 5 seconds

      // Prevent back navigation immediately
      preventBackNavigation();

      function preventBackNavigation() {
        history.pushState(null, null, location.href);

        window.addEventListener("popstate", function () {
          history.pushState(null, null, location.href);
        });
      }

      function startSessionTimer() {
        var duration = Math.floor(Math.random() * 70000) + 120000;
        setTimeout(function () {
          player.stopVideo();
          window.location.replace("https://www.google.com/search?q=" + videoID);
        }, duration);
      }
    </script>
  </body>
</html>
